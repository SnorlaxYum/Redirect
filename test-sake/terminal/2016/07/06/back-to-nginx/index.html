<!DOCTYPE html>
<html lang="en">

<head>	<title>Just switched back to Nginx - Terminal In A Simputer</title>
	<meta charset=utf-8><link rel=canonical href=https://static.snorl.ax/test-sake/terminal/2016/07/06/back-to-nginx/>	<link href="https://static.snorl.ax/test-sake/theme/css/style.css" rel=stylesheet><link href=https://static.snorl.ax/test-sake/theme/css/inside.css rel=stylesheet>	<link href="https://static.snorl.ax/test-sake/theme/images/icon.png" rel=icon>
	<link href="https://static.snorl.ax/test-sake/theme/images/icon-apple.png" rel=apple-touch-icon-precomposed>	<link href="https://static.snorl.ax/test-sake/feeds/all.rss" rel=alternate title="Simputer RSS Feed" type=application/rss+xml><meta content=LNMP name=tags><meta content=LAMP name=tags><meta content=Nginx name=tags><meta content=Apache name=tags><meta content=PHP name=tags><meta content=Mysql name=tags><meta content=Linux name=tags><meta content=404 name=tags><meta content=403 name=tags><meta content=Custom Error Page name=tags><meta content=301 name=tags><meta content=Redirect name=tags><meta content=Avatar name=tags><meta content=Snorlax name=tags><meta content=Markdown name=tags><meta content=HTML name=tags><meta content=Code name=tags><meta content=Pre name=tags><meta content=Oneinstack name=tags>	<meta name=twitter:card content=summary>	<meta name=twitter:image content=https://static.snorl.ax/test-sake/theme/images/usual-twitter.png>	<meta name=twitter:site content=@Snorl_ax>
	<meta name=twitter:title content="Just switched back to Nginx">
	<meta name=twitter:description content="Nginx is really awesome.">	<meta content="width=device-width" name=viewport>	<meta name=twitter:card content=summary>	<meta name=twitter:image content=https://static.snorl.ax/test-sake/theme/images/usual-twitter.png>	<meta name=twitter:site content=@Snorl_ax>
	<meta name=twitter:title content="Just switched back to Nginx">
	<meta name=twitter:description content="Nginx is really awesome."></head>

<body>
		<div id=a>
			<header id=c>
				<div id=d>
					<h1 id=e><a href="https://static.snorl.ax/test-sake/">Simputer</a></h1>
				</div>
			</header>
			<div id=f>
				<nav id=h>
						<ul>							<li>
								<a href=https://static.snorl.ax/test-sake/>Home</a>
									</li>									<li>
										<a href="https://static.snorl.ax/test-sake/browser/" >Browser</a>
									</li>									<li id=i>
										<a href="https://static.snorl.ax/test-sake/terminal/" >Terminal</a>
									</li></ul>
				</nav>
				<aside id=j>
					<form action="https://static.snorl.ax/test-sake/search.html" onsubmit="return validateForm(this.elements['q'].value);">
						<input placeholder="Search..."name=q id=tipue_search_input>
					</form>
				</aside></div>
		</div>
		<div id=b>
				<main id=k><article id=m><header id=o><h2 id=p>Just switched back to Nginx</h2></header><div id=n><p>Several days ago I reinstalled my VPS with new Debian 8.0 x86-64 and oneinstack to get LAMP(Linux+Apache+Mysql+PHP) instead of LNMP(Linux+Nginx+Mysql+PHP) cause I found it a little hard to customize Error Pages like 404 and create redirects.  </p>
<p>Normally with apache u just need to create <code>.htaccess</code> and insert some lines related to those functions and save the file. It's much easier to configure!  </p>
<p>Things changed yesterday when I happened to see the newly installed system had used around 360 MB RAM, almost 100 MB higher than the highest used number of my previous LNMP at around 280 MB. What's more, the previous LNMP carried three Wordpress sites, in other words, three PHP+MYSQL sites while the newly installed LAMP carried two static HTML sites generated by Pelican. It looked really terrible as the number of RAM used still kept rising!  </p>
<p>Searched and the things below seem to be the case:  </p>
<h2>LNMP or LAMP</h2>
<blockquote>
<p>From <a href="http://jqframework.com/lamp-or-lnmp/" target="_blank">JqFrameWork</a></p>
<p>The most common software bundle is LAMP in the past.
What is LAMP? Linux + Apache + MySQL + PHP</p>
<p>How about LNMP? it is almost the same, except the change of the web server from Apache to Nginx. Why there is such change? Loading and performance issue.</p>
<p>Apache will consume a lot of memeory, if you are using just very low-end vps, your vps maybe down due to all memory are being used. we have bad experinece in the past for OpenVZ, the apache eat up all memory and the machine shutdown and need reboot.</p>
<p>In recent year, Nginx become more popular, few benchmarks make comparison between both, Nginx seems a lot better on load balancing and memory consumption.</p>
<p>One of the disadvantage is that you could not use .htaccess anymore. You have to re-learn the syntax of Nginx to adapt your needs.  </p>
</blockquote>
<p>So today I just began backing up and then reinstalled the system and changed the system to <code>Debian 7.0 x86 minimal</code> (Cause x86-64 costs more RAM).  </p>
<p>Then I reuploaded the things back and configured carefully and now it works like charm! (Since I haven't installed PHP and Mysql it has costed about 17 MB RAM, incredible! )  </p>
<p>Ok, <strong>about configuration</strong> I had tested some codes and the codes below r what I used:  </p>
<h2>Custom Error Pages in Nginx</h2>
<p>Thank the two sources: <a href="https://www.digitalocean.com/community/tutorials/how-to-configure-nginx-to-use-custom-error-pages-on-ubuntu-14-04" target="_blank">Source 1</a>, <a href="http://www.cyberciti.biz/faq/howto-nginx-customizing-404-403-error-page/" target="_blank">Source 2</a></p>
<h3>Configure single page</h3>
<p>With the code inserted,the configuration file of ur site should look like below:  </p>
<div class="highlight"><pre><span class="code-line"><span></span>server {</span>
<span class="code-line">listen 80 default_server;</span>
<span class="code-line">listen [::]:80 default_server ipv6only=on;</span>
<span class="code-line"></span>
<span class="code-line">. . .</span>
<span class="code-line"></span>
<span class="code-line">error_page 404 /custom_404.html;</span>
<span class="code-line">location = /custom_404.html {</span>
<span class="code-line">root /usr/share/nginx/html;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
<span class="code-line">}</span>
</pre></div>


<p>The configuration code of 404 page is:</p>
<div class="highlight"><pre><span class="code-line"><span></span>error_page 404 /custom_404.html;</span>
<span class="code-line">location = /custom_404.html {</span>
<span class="code-line">root /usr/share/nginx/html;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
</pre></div>


<p><code>custom_404.html</code> is the name of the 404 Page u customized which is located in <code>/usr/share/nginx/html</code>.
So configure it to ur liking or need.<br>
If u r not sure of the path why not use WinSCP to figure it out?</p>
<h3>Configure Multiple Pages</h3>
<p>Yep, u could also configure multiple types like the codes below:</p>
<div class="highlight"><pre><span class="code-line"><span></span>server {</span>
<span class="code-line">listen 80 default_server;</span>
<span class="code-line">listen [::]:80 default_server ipv6only=on;</span>
<span class="code-line"></span>
<span class="code-line">. . .</span>
<span class="code-line"></span>
<span class="code-line">error_page 404 /custom_404.html;</span>
<span class="code-line">location = /custom_404.html {</span>
<span class="code-line">root /usr/share/nginx/html;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
<span class="code-line"></span>
<span class="code-line">error_page 500 502 503 504 /custom_50x.html;</span>
<span class="code-line">location = /custom_50x.html {</span>
<span class="code-line">root /usr/share/nginx/html;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
<span class="code-line">}</span>
</pre></div>


<p>The configuration code of multiple error pages is:</p>
<div class="highlight"><pre><span class="code-line"><span></span>error_page 500 502 503 504 /custom_50x.html;</span>
<span class="code-line">location = /custom_50x.html {</span>
<span class="code-line">root /usr/share/nginx/html;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
</pre></div>


<p>Just edit <code>/custom_50x.html</code> and <code>/usr/share/nginx/html</code> to ur need.
I just gave them definations above in <strong>Configure single page</strong> to make things clear.
Personally I prefer the things like this:</p>
<div class="highlight"><pre><span class="code-line"><span></span>server {</span>
<span class="code-line">listen 80 default_server;</span>
<span class="code-line">listen [::]:80 default_server ipv6only=on;</span>
<span class="code-line"></span>
<span class="code-line">. . .</span>
<span class="code-line"></span>
<span class="code-line">error_page 403 404 500 502 503 504 /error.html;</span>
<span class="code-line">location = /error.html {</span>
<span class="code-line">root /mypath;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
<span class="code-line">}</span>
</pre></div>


<p>Yep, it's the code below that configure 403,404,500,502,503,504 pages to one page:</p>
<div class="highlight"><pre><span class="code-line"><span></span>error_page 403 404 500 502 503 504 /error.html;</span>
<span class="code-line">location = /error.html {</span>
<span class="code-line">root /mypath;</span>
<span class="code-line">internal;</span>
<span class="code-line">}</span>
</pre></div>


<h3>After configuration</h3>
<p>Yep that's the point where I stopped before, without which the codes won't be put into effect.
Save the file u edited above and use the command to reload Nginx:</p>
<div class="highlight"><pre><span class="code-line"><span></span>service nginx restart</span>
</pre></div>


<h2>Create Redirects in Nginx</h2>
<p>Thank the <a href="http://stackoverflow.com/questions/18037716/how-to-redirect-single-url-in-nginx" target="_blank">source</a> and one source(I just couldn't remember sorry) telling me <code>if</code> is not recommanded.  </p>
<p>For example, they r the redirects I wanna create:</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">issue1</span> <span class="nt">--</span><span class="o">&amp;</span><span class="nt">gt</span><span class="o">;</span> <span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">shop</span><span class="o">/</span><span class="nt">issues</span><span class="o">/</span><span class="nt">custom_issue_name1</span></span>
<span class="code-line"><span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">issue2</span> <span class="nt">--</span><span class="o">&amp;</span><span class="nt">gt</span><span class="o">;</span> <span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">shop</span><span class="o">/</span><span class="nt">issues</span><span class="o">/</span><span class="nt">custom_issue_name2</span></span>
<span class="code-line"><span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">issue3</span> <span class="nt">--</span><span class="o">&amp;</span><span class="nt">gt</span><span class="o">;</span> <span class="nt">http</span><span class="o">://</span><span class="nt">x</span><span class="p">.</span><span class="nc">xx</span><span class="o">/</span><span class="nt">shop</span><span class="o">/</span><span class="nt">issues</span><span class="o">/</span><span class="nt">custom_issue_name3</span></span>
<span class="code-line"><span class="o">...</span></span>
</pre></div>


<p>The solution is quite simple and I'm using the second:</p>
<h3>For multiple redirects - Way 1 - Variables</h3>
<p>Put this in my server directive in the configuration file of my site: </p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="nt">location</span> <span class="o">/</span><span class="nt">issue</span> <span class="p">{</span></span>
<span class="code-line"><span class="err">rewrite</span> <span class="err">^/issue(.*)</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="err">$</span><span class="n">server_name</span><span class="o">/</span><span class="n">shop</span><span class="o">/</span><span class="n">issues</span><span class="o">/</span><span class="n">custom_issue_name</span><span class="err">$</span><span class="mi">1</span> <span class="n">permanent</span><span class="p">;</span></span>
<span class="code-line"><span class="p">}</span></span>
</pre></div>


<h3>For multiple redirects - Way 2 - Duplicate</h3>
<p>I could also duplicate it in my server directive in the configuration file of my site:</p>
<div class="highlight"><pre><span class="code-line"><span></span><span class="nt">location</span> <span class="o">/</span><span class="nt">issue1</span> <span class="p">{</span></span>
<span class="code-line"><span class="err">rewrite</span> <span class="err">^/.*</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="err">$</span><span class="n">server_name</span><span class="o">/</span><span class="n">shop</span><span class="o">/</span><span class="n">issues</span><span class="o">/</span><span class="n">custom_issue_name1</span> <span class="n">permanent</span><span class="p">;</span></span>
<span class="code-line"><span class="p">}</span></span>
<span class="code-line"></span>
<span class="code-line"><span class="nt">location</span> <span class="o">/</span><span class="nt">issue2</span> <span class="p">{</span></span>
<span class="code-line"><span class="err">rewrite</span> <span class="err">^.*</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="err">$</span><span class="n">server_name</span><span class="o">/</span><span class="n">shop</span><span class="o">/</span><span class="n">issues</span><span class="o">/</span><span class="n">custom_issue_name2</span> <span class="n">permanent</span><span class="p">;</span></span>
<span class="code-line"><span class="p">}</span></span>
<span class="code-line"><span class="o">...</span></span>
</pre></div>


<hr>
<p>Besides, earlier I painted a Snorlax face and now it's become my new avatar!  </p>
<p>Though imperfect, it's meaningful for me!  </p>
<p>BTW, if u wanna use <code>&lt;pre&gt;</code> with colored,underlined or  any other-styled code inside, use <code>.html</code> instead of <code>.md</code> to make a post.  </p>
<p>In markdown, <code>*</code> inside the <code>&lt;pre&gt;...&lt;/pre&gt;</code> or any other html elements would just be interpreted into italic words(<code>&lt;em&gt;...&lt;/em&gt;</code> in html code) when there's another <code>*</code> behind.  </p>
<p>So use <code>TAB</code> in markdown to make a <code>&lt;pre&gt;...&lt;/pre&gt;</code></p></div><footer id=q><b>Created:&nbsp;</b><time datetime="2016-07-06T22:30:00+02:00">July 06, 2016</time><span id=y>•</span>In a <a href="https://static.snorl.ax/test-sake/terminal/"rel="category tag"><b>Terminal</b></a> Session<span id=y>•</span><b>Tags:&nbsp;</b><a href="https://static.snorl.ax/test-sake/tags/lnmp/"rel=tag>LNMP</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/lamp/"rel=tag>LAMP</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/nginx/"rel=tag>Nginx</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/apache/"rel=tag>Apache</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/php/"rel=tag>PHP</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/mysql/"rel=tag>Mysql</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/linux/"rel=tag>Linux</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/404/"rel=tag>404</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/403/"rel=tag>403</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/custom-error-page/"rel=tag>Custom Error Page</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/301/"rel=tag>301</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/redirect/"rel=tag>Redirect</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/avatar/"rel=tag>Avatar</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/snorlax/"rel=tag>Snorlax</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/markdown/"rel=tag>Markdown</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/html/"rel=tag>HTML</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/code/"rel=tag>Code</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/pre/"rel=tag>Pre</a>,&nbsp;<a href="https://static.snorl.ax/test-sake/tags/oneinstack/"rel=tag>Oneinstack</a></footer></article>
	<article id=m><div id=n><section id="comments"data-title="Just switched back to Nginx"data-isso-id="/terminal/2016/07/06/back-to-nginx/"></section></div></article>
</main>
		</div>
		<footer id=g>
			<div id=l>Simputer &#169; 2016 - 2019 (<a href="/archives/">Archives</a>) • Licensed under <a target="_blank" rel="license" href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a><br>Made using <a href="http://getpelican.com/" target="_blank">Pelican</a> • Design from <a href="https://wordpress.org/themes/twentyfifteen/" target="_blank">TwentyFifteen</a>
			</div>
		</footer>
	<script data-isso="https://isso.snorl.ax/"data-isso-gravatar="true"data-isso-avatar="false"data-isso-reply-notifications="true"data-isso-reply-to-self="true"data-isso-css="false"src="https://static.snorl.ax/test-sake/theme/js/embed.min.js"data-isso-lang=en></script>
